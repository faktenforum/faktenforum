# Configuration file for Synapse.
#
# This is a YAML file: see [1] for a quick introduction. Note in particular
# that *indentation is important*: all the elements of a list or dictionary
# should have the same indentation.
#
# [1] https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html
#
# For more information on how to configure Synapse, including a complete accounting of
# each option, go to docs/usage/configuration/config_documentation.md or
# https://matrix-org.github.io/synapse/latest/usage/configuration/config_documentation.html
server_name: "chat.localhost:8000"
public_baseurl: "http://chat.localhost:8000/"
pid_file: /data/homeserver.pid
web_client_location: http://app.localhost:8000/
# Allow Presence tracking allows users to see the state (e.g online/offline)
allow_public_rooms_without_auth: false
block_non_admin_invites: true
presence:
  enabled: false
listeners:
  - port: 8008
    tls: false
    type: http
    x_forwarded: true
    resources:
      - names: [client]
        compress: false

database:
  name: psycopg2
  txn_limit: 10000
  args:
    user: synapse_user
    password: synapse_password
    database: synapse
    host: matrix-db
    port: 5432
    cp_min: 5
    cp_max: 10
log_config: "/config/chat.localhost.log.config"
enable_room_encryption: false
media_store_path: /data/media_store
registration_shared_secret: "rgTpw4n-5+#9yXp3#g5*r;;#=k8kCtrvkCYh9tiRgzm+Zlp;.Z"
report_stats: true
admin_contact: 'mailto:admin@faktenforum.org'

macaroon_secret_key: "=ipC8-WXz5:poWydyxM81eHW:JpMLl.qCWtV^T7y~u&N5^^LS1"
form_secret: "qVIy3PXbF~ZJ*ht,kHmKQ=U+~4QALAp^uOZPIJq*mu7z4yq2CS"
signing_key_path: "/config/chat.localhost.signing.key"
trusted_key_servers:
  - server_name: "matrix.org"
federation_domain_whitelist: []

require_membership_for_aliases: false
default_power_level_content_override:
   private_chat:
    events:
      "com.example.foo": 0
      "m.room.name": 50
      "m.room.power_levels": 100
      "m.room.history_visibility": 100
      "m.room.canonical_alias": 50
      "m.room.avatar": 50
      "m.room.tombstone": 100
      "m.room.server_acl": 100
      "m.room.encryption": 100
   trusted_private_chat: null
   public_chat: null

room_creation_rules:
  - action: deny
    default: true

rc_message:
  per_second: 1000  # Set a high value to effectively disable throttling
  burst_count: 1000 # Set a high value to effectively disable throttling

rc_registration:
  per_second: 1000  # Set a high value to effectively disable throttling
  burst_count: 1000 # Set a high value to effectively disable throttling

rc_login:
  address:
    per_second: 1000  # Set a high value to effectively disable throttling
    burst_count: 1000 # Set a high value to effectively disable throttling
  account:
    per_second: 1000  # Set a high value to effectively disable throttling
    burst_count: 1000 # Set a high value to effectively disable throttling
  failed_attempts:
    per_second: 1000  # Set a high value to effectively disable throttling
    burst_count: 1000 # Set a high value to effectively disable throttling

registration_disabled: true             
encryption_enabled_by_default_for_room_type: off
user_directory:
    enabled: false
enable_room_list_search: false
alias_creation_rules: 
  - user_id: "@system:chat.localhost:8000"
    action: allow

forget_rooms_on_leave: true


oidc_providers:
  - idp_id: github
    idp_name: Github
    idp_brand: "github"  # optional: styling hint for clients
    discover: false
    issuer: "https://github.com/"
    client_id: "Ov23lidjxeTwB6c5zNis" # TO BE FILLED
    client_secret: "1aad9d5b07516d8092709a4ab7527961025d7e46" # TO BE FILLED
    authorization_endpoint: "https://github.com/login/oauth/authorize"
    token_endpoint: "https://github.com/login/oauth/access_token"
    userinfo_endpoint: "https://api.github.com/user"
    scopes: ["read:user"]
    user_mapping_provider:
      config:
        subject_claim: "id"
        localpart_template: "{{ user.login }}"
        display_name_template: "{{ user.name }}"
  - idp_id: faktenforum
    client_id: ce58e62b-4295-4556-ae3c-0b80683f64db
    client_secret: synapse_secret
    idp_name: faktenforum
    idp_brand: correctiv
    discover: false
    skip_verification: true
    issuer: http://app.localhost:8000/api/v1/hydra
    jwks_uri: http://hydra:4444/.well-known/jwks.json
    scopes: ["openid", "profile", "email"]
    authorization_endpoint: http://app.localhost:8000/api/v1/hydra/oauth2/auth
    token_endpoint: http://hydra:4444/oauth2/token
    userinfo_endpoint: http://app.localhost:8000/api/v1/kratos/sessions/whoami
    user_mapping_provider:
      config:
        subject_claim: "id"
        localpart_template: "{{ user.username }}"
        display_name_template: "{{ user.username }}"
    
loggers:
  synapse:
    level: DEBUG
  synapse.handlers.oidc:
    level: DEBUG
  synapse.http.client:
    level: DEBUG